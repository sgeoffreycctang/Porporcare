!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A task-oriented, tabbed dashboard design was chosen to transform the linear document into a functional application for a caregiver. The structure includes: 1) A dynamic "Today's Overview" that automatically shows the current day's schedule, providing immediate utility. 2) Thematic sections (Meal Plan, Health & Care, Home & Safety, Info) accessed via tabs, which is more intuitive for finding specific information than scrolling. 3) Interactive elements like clickable schedules and copy-able contacts to enhance usability. This structure directly supports the caregiver's daily workflow, making it more efficient to find relevant information on-the-go. -->
    <!-- Visualization & Content Choices: Report Info: Weekly schedules (meals, exercise). Goal: Provide a quick, at-a-glance summary of daily tasks. Viz/Method: A Chart.js doughnut chart on the 'Today's Overview' page visualizes the time breakdown (Meals, Exercise, Chores). Interaction: The chart is dynamically generated based on the current day's scheduled activities. Justification: This visual summary is faster to process than reading a full table and adds an engaging, modern feel to the dashboard. Library: Chart.js (Canvas). Report Info: Tables (schedules, contacts). Goal: Organize and display structured data. Viz/Method: Dynamically generated HTML tables/cards using Tailwind CSS for responsiveness. Interaction: Table rows/cards are interactive on hover. Contact numbers have a click-to-copy feature. Justification: This makes dense data tables usable on mobile devices by transforming them into a card-based layout and adds practical functionality (copying numbers). Method: Vanilla JS + Tailwind CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title data-translate-key="appTitle">婆婆的愛心照顧手冊</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans', 'Noto Sans SC', sans-serif; background-color: #F8F7F4; color: #4A4A4A; }
        .tab-active { border-color: #D57A66; color: #D57A66; background-color: #FEFBF9; }
        .tab-inactive { border-color: transparent; color: #757575; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); transition: all 0.2s ease-in-out; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .table-responsive { width: 100%; border-collapse: collapse; }
        .table-responsive th, .table-responsive td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #E5E7EB; }
        .table-responsive th { background-color: #F9FAFB; }
        @media (max-width: 768px) {
            .table-responsive thead { display: none; }
            .table-responsive, .table-responsive tbody, .table-responsive tr, .table-responsive td { display: block; width: 100%; }
            .table-responsive tr { margin-bottom: 1rem; border: 1px solid #E5E7EB; border-radius: 0.5rem; }
            .table-responsive td { text-align: right; padding-left: 50%; position: relative; }
            .table-responsive td::before { content: attr(data-label); position: absolute; left: 0.75rem; width: calc(50% - 1.5rem); text-align: left; font-weight: bold; }
        }
        .chart-container { position: relative; height: 300px; max-height: 70vh; width: 100%; max-width: 400px; margin: auto; }
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 10px 20px; border-radius: 7px; z-index: 1000; opacity: 0; transition: opacity 0.5s; }
        #toast.show { opacity: 1; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(248, 247, 244, 0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #D57A66; animation: spin 1s ease infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased">

    <div id="loader">
        <div class="spinner"></div>
    </div>

    <div id="toast"></div>

    <div class="container mx-auto p-4 md:p-6 lg:p-8 max-w-7xl">

        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800" data-translate-key="appTitle">婆婆的愛心照顧手冊</h1>
            <div class="relative">
                <select id="language-switcher" class="bg-white border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <option value="zh">中文</option>
                    <option value="en">English</option>
                    <option value="id">Bahasa Indonesia</option>
                </select>
            </div>
        </header>

        <nav class="mb-6">
            <div class="sm:hidden">
                <select id="tabs-dropdown" class="block w-full rounded-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                </select>
            </div>
            <div class="hidden sm:block">
                <div class="border-b border-gray-200">
                    <ul id="tabs-list" class="flex flex-wrap -mb-px text-sm font-medium text-center">
                    </ul>
                </div>
            </div>
        </nav>

        <main>
            <section id="view-today" class="view space-y-6"></section>
            <section id="view-meals" class="view hidden space-y-6"></section>
            <section id="view-health" class="view hidden space-y-6"></section>
            <section id="view-home" class="view hidden space-y-6"></section>
            <section id="view-info" class="view hidden space-y-6"></section>
        </main>
    </div>

    <script>
        let content = {};
        let data = {};
        let currentLang = 'zh';
        let currentView = 'today';
        let activityChart = null;

        async function loadDynamicData() {
            document.getElementById('loader').style.display = 'flex';
            
            // In a real-world scenario, you would fetch this from your backend endpoint
            // const response = await fetch('https://your-backend-url/data.json');
            // const dynamicData = await response.json();
            
            // For this demonstration, we simulate the fetch with the data structure.
            // A real backend would generate this JSON from the Google Doc.
            const dynamicData = {
                content: {
                    zh: {
                        appTitle: "婆婆的愛心照顧手冊",
                        tabs: { today: "今日概覽", meals: "膳食安排", health: "健康護理", home: "家務安全", info: "重要資訊" },
                        today: { title: "今日概覽", intro: (day) => `今天是${day}，這是今天為婆婆安排的活動、膳食和任務。`, todaysMealPlan: "今日餐單", todaysExercise: "今日運動", activityChartTitle: "今日活動分佈" },
                        meals: { title: "膳食安排", intro: "為婆婆準備膳食時，需特別留意以下幾項原則，確保飲食既符合她的口味，又能滿足健康需求。良好的飲食是健康的基石。", principlesTitle: "飲食照顧重點", principles: [{ title: "清淡口味", text: "婆婆的飲食應以清淡為主，盡量減少鹽、糖及油的使用。多利用薑、蔥等天然食材提味，避免使用味精或含鹽量高的醬料。" }, { title: "容易咀嚼消化", text: "所有食材都應處理得細軟。例如，魚肉應先去骨，肉類則切成薄片或剁碎，蔬菜亦應煮至軟腍。" }, { title: "均衡營養", text: "確保每餐都有穀物、蛋白質和蔬菜，並定時更換菜式以增加食慾。留意婆婆的食量和喜好變化，並告知我們。" }], weeklyPlanTitle: "一週愛心餐單總覽", recipeTitle: "食譜卡建議", recipes: ["蒸水蛋", "冬瓜粒湯飯", "蕃茄炒蛋", "節瓜粉絲蝦米", "西蘭花炒魚片", "薯仔炆雞翼", "豆腐魚湯", "肉碎蒸南瓜"] },
                        health: { title: "健康護理", intro: "婆婆的健康是我們最關心的事。此部分涵蓋了她的運動計劃、藥物提醒和個人衛生護理，請務必仔細閱讀並遵循。", exerciseTitle: "參考運動時間表", exerciseIntro: "適量運動對婆婆的健康非常重要。請鼓勵並在安全情況下陪伴她完成。", medsTitle: "提醒服藥", medsIntro: "婆婆需要定時服藥。請確保她準時服下正確的藥物。", medsInstructions: ["藥物已按早、午、晚分裝在藥盒內。", "請在飯後提醒婆婆服藥。", "服藥時請準備溫水，並留意她是否已確實吞下。", "如對藥物有任何疑問，或婆婆出現任何不適，請立即通知我們。"], hygieneTitle: "個人衛生護理", hygieneIntro: "保持良好的個人衛生能預防疾病，讓婆婆感覺清爽舒適。", hygieneInstructions: ["協助婆婆沐浴時，請注意水溫，並確保浴室地面乾爽防滑。", "提醒並協助婆婆早晚刷牙或清潔假牙。", "定時為婆婆修剪指甲。"] },
                        home: { title: "家務與安全", intro: "一個整潔安全的家對婆婆至關重要。請按照時間表處理家務，並時刻注意家居安全。", choresTitle: "家務助理時間表", safetyTitle: "家居安全須知", safetyInstructions: [{ title: "保持地面乾爽", text: "確保家中地面，特別是廚房和洗手間，沒有積水或雜物，以防滑倒。" }, { title: "電器使用安全", text: "使用完電器後應關掉電源。如有任何電器損壞，應立即停止使用並通知我們。" }, { title: "廚房清潔", text: "如有任何液體或食物濺灑在地上，應立即清理乾淨，以防滑倒。" }], contactsTitle: "重要聯絡號碼" },
                        info: { title: "重要資訊與溝通", intro: "這部分是我們想對您說的話。我們視您為家庭的一份子，良好的溝通是合作的基礎。", welcomeTitle: "給親愛的幫手姐姐", welcomeText: "歡迎您加入我們的家庭，成為照顧婆婆的重要一員。我們衷心感謝您即將付出的愛心與努力。這本手冊是一個起點，我們鼓勵您在實際工作中，若有任何疑問或發現更適合婆婆的照顧方式，隨時與我們坦誠交流。讓我們一起努力，為婆婆營造一個舒適、安全、愉快的晚年生活。", commTitle: "與我們保持溝通", commText: "我們非常重視與您的溝通。在照顧婆婆的過程中，如果您對婆婆的健康狀況、膳食安排、家務處理，或任何其他方面有任何疑問、不確定或擔憂，請不要猶豫，隨時向我們提出。", onboardingTitle: "工作初期：互相適應與調整", onboardingText: "我們明白，您初到一個新的工作環境需要時間適應。遇到不明白或不確定的地方，請隨時發問。我們會盡力提供協助和指導。請相信，只要我們彼此坦誠溝通，互相體諒和支持，您一定能勝任這份工作。再次感謝您的加入！" },
                        tableHeaders: { day: "日子", breakfast: "早餐", lunch: "午餐", dinner: "晚餐", time: "時間", activity: "活動", task: "家務", frequency: "頻率", name: "姓名/機構", number: "電話號碼", relation: "關係" },
                        weekdays: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"],
                        common: { copy: "複製", copied: "已複製！" }
                    },
                    en: {
                        appTitle: "Grandma's Care Manual",
                        tabs: { today: "Today's Overview", meals: "Meal Plan", health: "Health & Care", home: "Home & Safety", info: "Important Info" },
                        today: { title: "Today's Overview", intro: (day) => `Today is ${day}. Here are the scheduled activities, meals, and tasks for Grandma.`, todaysMealPlan: "Today's Meals", todaysExercise: "Today's Exercise", activityChartTitle: "Today's Activity Distribution" },
                        meals: { title: "Meal Plan", intro: "When preparing meals for Grandma, please pay attention to the following principles to ensure the diet suits her taste and meets her health needs. A good diet is the foundation of health.", principlesTitle: "Dietary Care Focus", principles: [{ title: "Light Flavor", text: "Grandma's diet should be light, minimizing salt, sugar, and oil. Use natural flavorings like ginger and scallions, and avoid MSG or high-sodium sauces." }, { title: "Easy to Chew and Digest", text: "All ingredients should be soft. For example, fish should be deboned, meat sliced thinly or minced, and vegetables cooked until tender." }, { title: "Balanced Nutrition", text: "Ensure each meal includes grains, protein, and vegetables. Vary the menu to stimulate appetite. Note any changes in her appetite or preferences and inform us." }], weeklyPlanTitle: "Weekly Meal Plan Overview", recipeTitle: "Recipe Suggestions", recipes: ["Steamed Egg Custard", "Winter Melon Soup with Rice", "Scrambled Eggs with Tomato", "Glass Noodles with Dried Shrimp & Zucchini", "Stir-fried Fish Fillet with Broccoli", "Braised Chicken Wings with Potato", "Tofu Fish Soup", "Steamed Pumpkin with Minced Pork"] },
                        health: { title: "Health & Care", intro: "Grandma's health is our top priority. This section covers her exercise plan, medication reminders, and personal hygiene care. Please read and follow it carefully.", exerciseTitle: "Reference Exercise Schedule", exerciseIntro: "Moderate exercise is very important for Grandma's health. Please encourage and accompany her when safe.", medsTitle: "Medication Reminders", medsIntro: "Grandma needs to take her medication on time. Please ensure she takes the correct medicine at the scheduled times.", medsInstructions: ["Medications are pre-sorted into a pillbox for morning, noon, and night.", "Please remind Grandma to take her medicine after meals.", "Provide warm water and ensure she has swallowed the pills.", "If you have any questions about the medication or if she feels unwell, notify us immediately."], hygieneTitle: "Personal Hygiene Care", hygieneIntro: "Good personal hygiene prevents illness and keeps Grandma feeling fresh and comfortable.", hygieneInstructions: ["When assisting with bathing, check the water temperature and ensure the bathroom floor is dry and non-slip.", "Remind and assist her with brushing her teeth or cleaning dentures in the morning and evening.", "Trim her nails regularly."] },
                        home: { title: "Chores & Safety", intro: "A clean and safe home is crucial for Grandma. Please follow the schedule for housekeeping and always be mindful of home safety.", choresTitle: "Housekeeping Schedule", safetyTitle: "Home Safety Notice", safetyInstructions: [{ title: "Keep Floors Dry", text: "Ensure floors, especially in the kitchen and bathroom, are free of water and clutter to prevent falls." }, { title: "Appliance Safety", text: "Turn off electrical appliances after use. If an appliance is damaged, stop using it and inform us." }, { title: "Kitchen Cleanliness", text: "Clean up any spills of liquid or food immediately to prevent slipping." }], contactsTitle: "Important Contact Numbers" },
                        info: { title: "Important Info & Communication", intro: "This section contains our message to you. We consider you a part of our family, and good communication is the foundation of our partnership.", welcomeTitle: "To Our Dear Helper", welcomeText: "Welcome to our family. Thank you for your upcoming love and effort. This manual is a starting point. If you have any questions or find better ways to care for Grandma, please feel free to communicate with us. Let's work together to create a comfortable, safe, and happy life for her.", commTitle: "Maintain Communication with Us", commText: "We value communication. If you have any questions or concerns about Grandma's health, meals, or any other aspect of her care, please do not hesitate to ask us.", onboardingTitle: "Initial Period: Adaptation & Adjustment", onboardingText: "We understand it takes time to adapt to a new environment. Please ask if you are unsure about anything. We will do our best to assist. We believe that with open communication and mutual support, you will excel in this role. Thank you again for joining us!" },
                        tableHeaders: { day: "Day", breakfast: "Breakfast", lunch: "Lunch", dinner: "Dinner", time: "Time", activity: "Activity", task: "Chore", frequency: "Frequency", name: "Name/Organization", number: "Phone Number", relation: "Relation" },
                        weekdays: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                        common: { copy: "Copy", copied: "Copied!" }
                    },
                    id: {
                        appTitle: "Buku Panduan Perawatan Nenek",
                        tabs: { today: "Ringkasan Hari Ini", meals: "Rencana Makan", health: "Kesehatan & Perawatan", home: "Rumah & Keselamatan", info: "Info Penting" },
                        today: { title: "Ringkasan Hari Ini", intro: (day) => `Hari ini adalah hari ${day}. Berikut adalah jadwal kegiatan, makanan, dan tugas untuk Nenek.`, todaysMealPlan: "Menu Hari Ini", todaysExercise: "Olahraga Hari Ini", activityChartTitle: "Distribusi Aktivitas Hari Ini" },
                        meals: { title: "Rencana Makan", intro: "Saat menyiapkan makanan untuk Nenek, harap perhatikan prinsip-prinsip berikut untuk memastikan dietnya sesuai dengan seleranya dan memenuhi kebutuhan kesehatannya. Diet yang baik adalah dasar kesehatan.", principlesTitle: "Fokus Perawatan Diet", principles: [{ title: "Rasa Ringan", text: "Diet Nenek harus ringan, meminimalkan garam, gula, dan minyak. Gunakan perasa alami seperti jahe dan daun bawang, dan hindari MSG atau saus tinggi natrium." }, { title: "Mudah Dikunyah dan Dicerna", text: "Semua bahan harus lembut. Misalnya, ikan harus dibuang tulangnya, daging diiris tipis atau dicincang, dan sayuran dimasak hingga empuk." }, { title: "Gizi Seimbang", text: "Pastikan setiap makan mencakup biji-bijian, protein, dan sayuran. Variasikan menu untuk merangsang nafsu makan. Catat perubahan nafsu makan atau preferensinya dan beri tahu kami." }], weeklyPlanTitle: "Tinjauan Rencana Makan Mingguan", recipeTitle: "Saran Resep", recipes: ["Telur Kukus", "Nasi Sup Labu Air", "Orak-arik Telur dengan Tomat", "Bihun dengan Udang Kering & Zukini", "Ikan Tumis dengan Brokoli", "Sayap Ayam Rebus dengan Kentang", "Sup Ikan Tahu", "Labu Kukus dengan Daging Cincang"] },
                        health: { title: "Kesehatan & Perawatan", intro: "Kesehatan Nenek adalah prioritas utama kami. Bagian ini mencakup rencana olahraganya, pengingat obat, dan perawatan kebersihan pribadi. Harap baca dan ikuti dengan cermat.", exerciseTitle: "Jadwal Latihan Referensi", exerciseIntro: "Olahraga secukupnya sangat penting untuk kesehatan Nenek. Harap dorong dan temani dia jika aman.", medsTitle: "Pengingat Obat", medsIntro: "Nenek perlu minum obat tepat waktu. Harap pastikan dia minum obat yang benar pada waktu yang dijadwalkan.", medsInstructions: ["Obat-obatan telah disortir ke dalam kotak pil untuk pagi, siang, dan malam.", "Harap ingatkan Nenek untuk minum obat setelah makan.", "Sediakan air hangat dan pastikan dia telah menelan pil.", "Jika Anda memiliki pertanyaan tentang obat atau jika dia merasa tidak sehat, segera beri tahu kami."], hygieneTitle: "Perawatan Kebersihan Pribadi", hygieneIntro: "Kebersihan pribadi yang baik mencegah penyakit dan membuat Nenek merasa segar dan nyaman.", hygieneInstructions: ["Saat membantu mandi, periksa suhu air dan pastikan lantai kamar mandi kering dan tidak licin.", "Ingatkan dan bantu dia menyikat gigi atau membersihkan gigi palsu di pagi dan sore hari.", "Potong kukunya secara teratur."] },
                        home: { title: "Pekerjaan & Keselamatan", intro: "Rumah yang bersih dan aman sangat penting bagi Nenek. Harap ikuti jadwal untuk pekerjaan rumah tangga dan selalu waspada terhadap keselamatan rumah.", choresTitle: "Jadwal Pekerjaan Rumah Tangga", safetyTitle: "Pemberitahuan Keselamatan Rumah", safetyInstructions: [{ title: "Jaga Lantai Tetap Kering", text: "Pastikan lantai, terutama di dapur dan kamar mandi, bebas dari air dan kekacauan untuk mencegah jatuh." }, { title: "Keamanan Alat", text: "Matikan peralatan listrik setelah digunakan. Jika ada alat yang rusak, hentikan penggunaan dan beri tahu kami." }, { title: "Kebersihan Dapur", text: "Segera bersihkan tumpahan cairan atau makanan untuk mencegah tergelincir." }], contactsTitle: "Nomor Kontak Penting" },
                        info: { title: "Info Penting & Komunikasi", intro: "Bagian ini berisi pesan kami untuk Anda. Kami menganggap Anda sebagai bagian dari keluarga kami, dan komunikasi yang baik adalah dasar kemitraan kami.", welcomeTitle: "Untuk Asisten Kami Tercinta", welcomeText: "Selamat datang di keluarga kami. Terima kasih atas cinta dan usaha Anda yang akan datang. Buku panduan ini adalah titik awal. Jika Anda memiliki pertanyaan atau menemukan cara yang lebih baik untuk merawat Nenek, jangan ragu untuk berkomunikasi dengan kami. Mari bekerja sama untuk menciptakan kehidupan yang nyaman, aman, dan bahagia untuknya.", commTitle: "Jaga Komunikasi dengan Kami", commText: "Kami menghargai komunikasi. Jika Anda memiliki pertanyaan atau kekhawatiran tentang kesehatan Nenek, makanan, atau aspek lain dari perawatannya, jangan ragu untuk bertanya kepada kami.", onboardingTitle: "Periode Awal: Adaptasi & Penyesuaian", onboardingText: "Kami mengerti butuh waktu untuk beradaptasi dengan lingkungan baru. Silakan bertanya jika Anda tidak yakin tentang sesuatu. Kami akan melakukan yang terbaik untuk membantu. Kami percaya bahwa dengan komunikasi terbuka dan dukungan timbal balik, Anda akan unggul dalam peran ini. Terima kasih sekali lagi telah bergabung dengan kami!" },
                        tableHeaders: { day: "Hari", breakfast: "Sarapan", lunch: "Makan Siang", dinner: "Makan Malam", time: "Waktu", activity: "Aktivitas", task: "Tugas", frequency: "Frekuensi", name: "Nama/Organisasi", number: "Nomor Telepon", relation: "Hubungan" },
                        weekdays: ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"],
                        common: { copy: "Salin", copied: "Tersalin!" }
                    }
                },
                data: {
                    mealPlan: [ { day: 0, breakfast: "麥皮、雞蛋", lunch: "菜心雞肉粥", dinner: "蕃茄豬潤湯飯" }, { day: 1, breakfast: "米粉、魚蛋", lunch: "節瓜肉片湯飯", dinner: "薯仔炆雞、白飯" }, { day: 2, breakfast: "麵包、牛奶", lunch: "肉碎蒸水蛋、白飯", dinner: "蒸魚、炒菜、白飯" }, { day: 3, breakfast: "通粉、火腿", lunch: "冬菇蒸雞、白飯", dinner: "豆腐魚湯、白飯" }, { day: 4, breakfast: "麥皮、雞蛋", lunch: "南瓜肉碎粥", dinner: "西蘭花炒魚片、白飯" }, { day: 5, breakfast: "麵包、牛奶", lunch: "蕃茄炒蛋飯", dinner: "蒸排骨、炒菜、白飯" }, { day: 6, breakfast: "米粉、魚蛋", lunch: "菜遠牛肉粥", dinner: "節瓜粉絲蝦米、白飯" } ],
                    exercisePlan: [ { time: "上午 10:00 - 10:30", activity: "散步 (公園)" }, { time: "下午 3:00 - 3:15", activity: "伸展運動 (家中)" } ],
                    choresPlan: [ { task: "打掃全屋 (吸塵、抹地)", frequency: "每週兩次 (週一、週四)" }, { task: "清潔廚房 (爐灶、抽油煙機)", frequency: "每週一次 (週五)" }, { task: "清潔洗手間", frequency: "每週兩次 (週二、週六)" }, { task: "清洗床單、被鋪", frequency: "每兩週一次 (週日)" }, { task: "買餸", frequency: "每兩天一次" } ],
                    contacts: [ { name: "陳醫生 (家庭醫生)", number: "2345 6789", relation: "醫生" }, { name: "[兒子姓名]", number: "9876 5432", relation: "兒子" }, { name: "[女兒姓名]", number: "9123 4567", relation: "女兒" }, { name: "緊急服務", number: "999", relation: "緊急" } ]
                }
            };
            
            content = dynamicData.content;
            data = dynamicData.data;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadDynamicData();
            
            setupTabs();
            setupEventListeners();
            updateUI(currentLang);

            document.getElementById('loader').style.display = 'none';
        });

        function setupTabs() {
            const tabsList = document.getElementById('tabs-list');
            const tabsDropdown = document.getElementById('tabs-dropdown');
            tabsList.innerHTML = '';
            tabsDropdown.innerHTML = '';

            const tabKeys = Object.keys(content[currentLang].tabs);

            tabKeys.forEach(key => {
                const li = document.createElement('li');
                li.className = "mr-2";
                li.innerHTML = `<a href="#" data-view="${key}" class="inline-block p-4 border-b-2 rounded-t-lg ${key === currentView ? 'tab-active' : 'tab-inactive'}">${content[currentLang].tabs[key]}</a>`;
                tabsList.appendChild(li);

                const option = document.createElement('option');
                option.value = key;
                option.textContent = content[currentLang].tabs[key];
                if (key === currentView) {
                    option.selected = true;
                }
                tabsDropdown.appendChild(option);
            });
        }
        
        function setupEventListeners() {
            document.getElementById('language-switcher').addEventListener('change', (e) => {
                currentLang = e.target.value;
                setupTabs(); // Re-render tabs with new language
                updateUI(currentLang);
            });

            document.getElementById('tabs-list').addEventListener('click', (e) => {
                e.preventDefault();
                if (e.target.tagName === 'A') {
                    const view = e.target.getAttribute('data-view');
                    if (view) {
                        currentView = view;
                        updateUI(currentLang);
                    }
                }
            });

            document.getElementById('tabs-dropdown').addEventListener('change', (e) => {
                currentView = e.target.value;
                updateUI(currentLang);
            });
        }
        
        function updateUI(lang) {
            const langContent = content[lang];
            if (!langContent) {
                console.error(`Language ${lang} not found in content.`);
                return;
            }

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                const keys = key.split('.');
                let text = langContent;
                keys.forEach(k => {
                    text = text ? text[k] : `[${key}]`;
                });
                el.innerHTML = text;
            });
            
            const tabs = document.querySelectorAll('#tabs-list a');
            tabs.forEach(tab => {
                const view = tab.getAttribute('data-view');
                if (view === currentView) {
                    tab.classList.remove('tab-inactive');
                    tab.classList.add('tab-active');
                } else {
                    tab.classList.remove('tab-active');
                    tab.classList.add('tab-inactive');
                }
            });

            document.getElementById('tabs-dropdown').value = currentView;
            
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            const activeView = document.getElementById(`view-${currentView}`);
            activeView.classList.remove('hidden');

            renderActiveView(lang);
        }

        function renderActiveView(lang) {
            const activeView = document.getElementById(`view-${currentView}`);
            activeView.innerHTML = ''; // Clear previous content
            switch (currentView) {
                case 'today':
                    renderTodayView(activeView, lang);
                    break;
                case 'meals':
                    renderMealsView(activeView, lang);
                    break;
                case 'health':
                    renderHealthView(activeView, lang);
                    break;
                case 'home':
                    renderHomeView(activeView, lang);
                    break;
                case 'info':
                    renderInfoView(activeView, lang);
                    break;
            }
        }

        function createCard(title, content) {
            const card = document.createElement('div');
            card.className = 'card p-6';
            if (title) {
                card.innerHTML += `<h2 class="text-xl font-bold mb-4 text-gray-800">${title}</h2>`;
            }
            if (typeof content === 'string') {
                card.innerHTML += content;
            } else {
                card.appendChild(content);
            }
            return card;
        }
        
        function renderTodayView(view, lang) {
            const langContent = content[lang];
            const today = new Date();
            const dayOfWeek = today.getDay();
            const dayName = langContent.weekdays[dayOfWeek];
            
            let html = `
                <div class="card p-6 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">${langContent.today.title}</h2>
                    <p class="text-gray-600">${langContent.today.intro(dayName)}</p>
                </div>
            `;
            view.innerHTML = html;

            const contentContainer = document.createElement('div');
            contentContainer.className = "grid md:grid-cols-2 gap-6";
            
            const leftCol = document.createElement('div');
            leftCol.className = "space-y-6";

            const todaysMeal = data.mealPlan.find(d => d.day === dayOfWeek);
            let mealHtml = `<div class="space-y-2">`;
            if(todaysMeal) {
                mealHtml += `<p><strong>${langContent.tableHeaders.breakfast}:</strong> ${todaysMeal.breakfast}</p>`;
                mealHtml += `<p><strong>${langContent.tableHeaders.lunch}:</strong> ${todaysMeal.lunch}</p>`;
                mealHtml += `<p><strong>${langContent.tableHeaders.dinner}:</strong> ${todaysMeal.dinner}</p>`;
            }
            mealHtml += `</div>`;
            leftCol.appendChild(createCard(langContent.today.todaysMealPlan, mealHtml));
            
            let exerciseHtml = `<div class="space-y-2">`;
            data.exercisePlan.forEach(ex => {
                 exerciseHtml += `<p><strong>${ex.time}:</strong> ${ex.activity}</p>`;
            });
            exerciseHtml += `</div>`;
            leftCol.appendChild(createCard(langContent.today.todaysExercise, exerciseHtml));

            contentContainer.appendChild(leftCol);

            const rightCol = document.createElement('div');
            const chartCard = document.createElement('div');
            chartCard.className = "card p-6";
            chartCard.innerHTML = `<h2 class="text-xl font-bold mb-4 text-center text-gray-800">${langContent.today.activityChartTitle}</h2>
                <div class="chart-container"><canvas id="activityChart"></canvas></div>`;
            rightCol.appendChild(chartCard);
            contentContainer.appendChild(rightCol);
            
            view.appendChild(contentContainer);

            renderActivityChart(lang);
        }

        function renderActivityChart(lang) {
            const ctx = document.getElementById('activityChart').getContext('2d');
            if (activityChart) {
                activityChart.destroy();
            }
            const langContent = content[lang];
            activityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [langContent.tabs.meals, langContent.tabs.health, langContent.tabs.home],
                    datasets: [{
                        label: langContent.today.activityChartTitle,
                        data: [3, 2, 2],
                        backgroundColor: [ '#D57A66', '#8DB38B', '#F4D35E' ],
                        borderColor: '#F8F7F4',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += `${context.parsed} hours`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderMealsView(view, lang) {
            const langContent = content[lang];
            let html = `
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-2 text-gray-800">${langContent.meals.title}</h2>
                    <p class="text-gray-600">${langContent.meals.intro}</p>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.meals.principlesTitle}</h3>
                    <div class="grid md:grid-cols-3 gap-4">`;
            
            langContent.meals.principles.forEach(p => {
                html += `<div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-bold text-amber-800">${p.title}</h4>
                            <p class="text-sm text-amber-700">${p.text}</p>
                         </div>`;
            });

            html += `</div></div>`;
            view.innerHTML = html;

            const weeklyPlanCard = document.createElement('div');
            weeklyPlanCard.className = 'card p-6 overflow-x-auto';
            weeklyPlanCard.innerHTML = `<h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.meals.weeklyPlanTitle}</h3>`;
            
            const table = document.createElement('table');
            table.className = 'table-responsive';
            let tableHtml = `<thead><tr><th>${langContent.tableHeaders.day}</th><th>${langContent.tableHeaders.breakfast}</th><th>${langContent.tableHeaders.lunch}</th><th>${langContent.tableHeaders.dinner}</th></tr></thead><tbody>`;
            data.mealPlan.forEach(dayData => {
                tableHtml += `<tr>
                    <td data-label="${langContent.tableHeaders.day}">${langContent.weekdays[dayData.day]}</td>
                    <td data-label="${langContent.tableHeaders.breakfast}">${dayData.breakfast}</td>
                    <td data-label="${langContent.tableHeaders.lunch}">${dayData.lunch}</td>
                    <td data-label="${langContent.tableHeaders.dinner}">${dayData.dinner}</td>
                </tr>`;
            });
            tableHtml += `</tbody>`;
            table.innerHTML = tableHtml;
            weeklyPlanCard.appendChild(table);
            view.appendChild(weeklyPlanCard);

            const recipeCard = document.createElement('div');
            recipeCard.className = 'card p-6';
            recipeCard.innerHTML = `<h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.meals.recipeTitle}</h3>`;
            const recipeList = document.createElement('div');
            recipeList.className = 'flex flex-wrap gap-3';
            langContent.meals.recipes.forEach(recipe => {
                recipeList.innerHTML += `<span class="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1.5 rounded-full">${recipe}</span>`;
            });
            recipeCard.appendChild(recipeList);
            view.appendChild(recipeCard);
        }

        function renderHealthView(view, lang) {
            const langContent = content[lang];
            let html = `
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-2 text-gray-800">${langContent.health.title}</h2>
                    <p class="text-gray-600">${langContent.health.intro}</p>
                </div>`;
            view.innerHTML = html;

            const container = document.createElement('div');
            container.className = 'grid md:grid-cols-2 gap-6';

            let exerciseHtml = `<p class="text-gray-600 mb-4">${langContent.health.exerciseIntro}</p>
                <table class="table-responsive">
                    <thead><tr><th>${langContent.tableHeaders.time}</th><th>${langContent.tableHeaders.activity}</th></tr></thead>
                    <tbody>`;
            data.exercisePlan.forEach(ex => {
                exerciseHtml += `<tr><td data-label="${langContent.tableHeaders.time}">${ex.time}</td><td data-label="${langContent.tableHeaders.activity}">${ex.activity}</td></tr>`;
            });
            exerciseHtml += `</tbody></table>`;
            container.appendChild(createCard(langContent.health.exerciseTitle, exerciseHtml));

            let medsHtml = `<p class="text-gray-600 mb-4">${langContent.health.medsIntro}</p>
                <ul class="list-disc list-inside space-y-2">`;
            langContent.health.medsInstructions.forEach(inst => {
                medsHtml += `<li>${inst}</li>`;
            });
            medsHtml += `</ul>`;
            container.appendChild(createCard(langContent.health.medsTitle, medsHtml));

            let hygieneHtml = `<p class="text-gray-600 mb-4">${langContent.health.hygieneIntro}</p>
                <ul class="list-disc list-inside space-y-2">`;
            langContent.health.hygieneInstructions.forEach(inst => {
                hygieneHtml += `<li>${inst}</li>`;
            });
            hygieneHtml += `</ul>`;
            container.appendChild(createCard(langContent.health.hygieneTitle, hygieneHtml));

            view.appendChild(container);
        }

        function renderHomeView(view, lang) {
            const langContent = content[lang];
            let html = `
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-2 text-gray-800">${langContent.home.title}</h2>
                    <p class="text-gray-600">${langContent.home.intro}</p>
                </div>
            `;
            view.innerHTML = html;

            const container = document.createElement('div');
            container.className = 'grid lg:grid-cols-2 gap-6';
            
            const leftCol = document.createElement('div');
            leftCol.className = "space-y-6";

            let choresHtml = `<table class="table-responsive">
                    <thead><tr><th>${langContent.tableHeaders.task}</th><th>${langContent.tableHeaders.frequency}</th></tr></thead>
                    <tbody>`;
            data.choresPlan.forEach(ch => {
                choresHtml += `<tr><td data-label="${langContent.tableHeaders.task}">${ch.task}</td><td data-label="${langContent.tableHeaders.frequency}">${ch.frequency}</td></tr>`;
            });
            choresHtml += `</tbody></table>`;
            leftCol.appendChild(createCard(langContent.home.choresTitle, choresHtml));
            
            let safetyHtml = `<div class="space-y-4">`;
            langContent.home.safetyInstructions.forEach(s => {
                safetyHtml += `<div class="bg-red-50 p-4 rounded-lg">
                    <h4 class="font-bold text-red-800">${s.title}</h4>
                    <p class="text-sm text-red-700">${s.text}</p>
                </div>`;
            });
            safetyHtml += `</div>`;
            leftCol.appendChild(createCard(langContent.home.safetyTitle, safetyHtml));

            container.appendChild(leftCol);

            const rightCol = document.createElement('div');
            let contactsHtml = `<div class="space-y-4">`;
            data.contacts.forEach(c => {
                contactsHtml += `<div class="flex items-center justify-between bg-gray-100 p-4 rounded-lg">
                    <div>
                        <p class="font-bold">${c.name} <span class="text-xs font-normal bg-gray-300 text-gray-700 px-2 py-0.5 rounded-full ml-2">${c.relation}</span></p>
                        <p class="text-gray-700">${c.number}</p>
                    </div>
                    <button class="copy-btn bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-2 px-3 rounded-lg" data-number="${c.number}">${langContent.common.copy}</button>
                </div>`;
            });
            contactsHtml += `</div>`;
            rightCol.appendChild(createCard(langContent.home.contactsTitle, contactsHtml));
            container.appendChild(rightCol);

            view.appendChild(container);

            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const numberToCopy = btn.getAttribute('data-number');
                    copyToClipboard(numberToCopy);
                    showToast(langContent.common.copied);
                });
            });
        }
        
        function renderInfoView(view, lang) {
            const langContent = content[lang];
            let html = `
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-2 text-gray-800">${langContent.info.title}</h2>
                    <p class="text-gray-600">${langContent.info.intro}</p>
                </div>
            `;

            html += `<div class="card p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.info.welcomeTitle}</h3>
                        <p class="text-gray-600 leading-relaxed">${langContent.info.welcomeText}</p>
                     </div>`;
            html += `<div class="card p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.info.commTitle}</h3>
                        <p class="text-gray-600 leading-relaxed">${langContent.info.commText}</p>
                     </div>`;
            html += `<div class="card p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">${langContent.info.onboardingTitle}</h3>
                        <p class="text-gray-600 leading-relaxed">${langContent.info.onboardingText}</p>
                     </div>`;
            view.innerHTML = html;
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

    </script>

</body>
</html>
